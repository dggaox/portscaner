#端口扫描实验
----------------------------
##1.实验介绍
----------------------------
端口扫描工具（Port Scanner）指用于探测服务器或主机开放端口情况的工具。常被计算机管理员用于确认安全策略，同时被攻击者用于识别目标主机上的可运作的网络服务。

端口扫描定义是客户端向一定范围的服务器端口发送对应请求，以此确认可使用的端口。虽然其本身并不是恶意的网络活动，但也是网络攻击者探测目标主机服务，以利用该服务的已知漏洞的重要手段。端口扫描的主要用途仍然只是确认远程机器某个服务的可用性。

扫描多个主机以获取特定的某个端口被称为端口清扫（Portsweep），以此获取特定的服务。例如，基于SQL服务的计算机蠕虫就会清扫大量主机的同一端口以在 1433 端口上建立TCP连接。

端口扫描，就是对一段端口或指定的端口进行扫描。通过扫描结果可以知道一台计算机上都提供了哪些服务，然后就可以通过所提供的这些服务的己知漏洞就可进行攻击。其原理是当一个主机向远端一个服务器的某一个端口提出建立一个连接的请求，如果对方有此项服务，就会应答，如果对方未安装此项服务时，即使你向相应的端口发出请求，对方仍无应答，利用这个原理，如果对所有熟知端口或自己选定的某个范围内的熟知端口分别建立连接，并记录下远端服务器所给予的应答，便可知道哪些端口是开放的。

##2.实验设备
------------------------------
自己的笔记本电脑（Windows 7旗舰版），Ubuntu（Linux）系统，python，火绒剑分析

##3.实验原理
----------------------------
最简单的端口扫描工具使用 TCP 连接扫描的方式，即利用操作系统原生的网络功能，且通常作为SYN扫描的替代选项。Nmap将这种模式称为连接扫描，因为使用了类似 Unix 系统的 connect() 命令。如果该端口是开放的，操作系统就能完成TCP三次握手，然后端口扫描工具会立即关闭刚建立的该连接，防止拒绝服务攻击。这种扫描模式的优势是用户无需特殊权限。但使用操作系统原生网络功能不能实现底层控制，因此这种扫描方式并不流行。并且TCP扫描很容易被发现，尤其作为端口清扫的手段：这些服务会记录发送者的IP地址，入侵检测系统可能触发警报。

还有另外一种扫描方式是 SYN 扫描，端口扫描工具不使用操作系统原生网络功能，而是自行生成、发送IP数据包，并监控其回应。这种扫描模式被称为“半开放扫描”，因为它从不建立完整的TCP连接。端口扫描工具生成一个SYN包，如果目标端口开放，则会返回 SYN-ACK 包。扫描端回应一个RST包，然后在握手完成前关闭连接。如果端口关闭了但未使用过滤，目标端口应该会持续返回RST包。这种粗略的网络利用方式有几个优点：给扫描工具全权控制数据包发送和等待回应时长的权力，允许更详细的回应分析。关于哪一种对目标主机的扫描方式更不具备入侵性存在一些争议，但SYN扫描的优势是从不会建立完整的连接。然而，RST包可能导致网络堵塞，尤其是一些简单如打印机之类的网络设备。

##4.实验步骤
----------------------------
###1.首先采用cmd命令查看本机端口情况（netstat –a -n）
----------------------------
[![GqhvQI.png](https://s1.ax1x.com/2020/04/12/GqhvQI.png)](https://imgchr.com/i/GqhvQI)

###2.使用Python提供socket模块制造一个简易的端口扫描器，需要对python3的socket和threading模块进行调用。调用socket.connect_ex((ip, port))，端口开放则返回0，否则返回错误代码。
----------------------------
[![GqoKTf.png](https://s1.ax1x.com/2020/04/12/GqoKTf.png)](https://imgchr.com/i/GqoKTf)

###3.首先在Ubuntu下运行py文件：
----------------------------
[![GqIOW4.png](https://s1.ax1x.com/2020/04/12/GqIOW4.png)](https://imgchr.com/i/GqIOW4)

###4.首先对远程IP地址扫描，扫描的是同一个网段下的电脑主机。端口扫描在自己笔记本上运行。
----------------------------
对远程主机192.168.0.103进行扫描，端口范围在1到65535，其中使用单线程扫描。预计时间较长。运行截图如下：
[![Gq7rLR.png](https://s1.ax1x.com/2020/04/12/Gq7rLR.png)](https://imgchr.com/i/Gq7rLR)

[![Gq7jSg.png](https://s1.ax1x.com/2020/04/12/Gq7jSg.png)](https://imgchr.com/i/Gq7jSg)

共计扫描完成共计用时约413.62秒，大概7分钟左右。端口大部分都是在关闭的，只有少部分在打开，因为防护墙软件为了保护电脑安全，习惯上会把无用端口关闭，减少非法入侵。但是测试结果说明了单线程时间较长，效率太低。所以我要开多线程尝试，看看对比效果如何。把线程增加分别到100,1000。
[![GqbiDA.png](https://s1.ax1x.com/2020/04/12/GqbiDA.png)](https://imgchr.com/i/GqbiDA)

[![GqbQDs.png](https://s1.ax1x.com/2020/04/12/GqbQDs.png)](https://imgchr.com/i/GqbQDs)
开启了线程数量100时，时间上明显快了许多，共计用时约27.27秒，看来多线程端口扫描能够提供效率。
接着我开启线程数量1000
[![GqqJeA.png](https://s1.ax1x.com/2020/04/12/GqqJeA.png)](https://imgchr.com/i/GqqJeA)

[![GqqrLj.png](https://s1.ax1x.com/2020/04/12/GqqrLj.png)](https://imgchr.com/i/GqqrLj)

开启了线程数量1000时，时间上更快了，共计用时约3.61秒。

###5.然后对公共网站进行扫描，选取了百度和一些小网站：
----------------------------
[![GqLjNq.png](https://s1.ax1x.com/2020/04/12/GqLjNq.png)](https://imgchr.com/i/GqLjNq)

[![GLePMQ.png](https://s1.ax1x.com/2020/04/12/GLePMQ.png)](https://imgchr.com/i/GLePMQ)

[![GLeeiV.png](https://s1.ax1x.com/2020/04/12/GLeeiV.png)](https://imgchr.com/i/GLeeiV)

个人猜测，大公司网站的服务器端口为了安全起见，有些是关闭的，只能扫描出来部分端口是开放的。小公司小网站的服务器倒是能够扫描出来许多开放端口。

###6.最后对我本人手机的的IP进行扫描：
----------------------------
[![Gq7toV.jpg](https://s1.ax1x.com/2020/04/12/Gq7toV.jpg)](https://imgchr.com/i/Gq7toV)
[![GLmIje.png](https://s1.ax1x.com/2020/04/12/GLmIje.png)](https://imgchr.com/i/GLmIje)

当然，也可以用火绒安全软件的专用工具查看端口状态：
[![GLnwVA.png](https://s1.ax1x.com/2020/04/12/GLnwVA.png)](https://imgchr.com/i/GLnwVA)

#5.实验总结
---------------
通过本节实验的学习，我掌握了Python 网络开发、Socket 基础知识和端口扫描概念以及Python 多线程的相关知识。通过本次实验，顺利完成的端口扫描的任务，单线程和多线程在效率上有很大差别。但是我的程序也有不足之处，比如创建的线程数貌似没有设置上限，如果系统中的线程过多时会出现影响系统性能的情况，所以这个程序还有很大的改进空间。另外Python多线程还有很多更高级的方法可以使用。当然也可以使用通过nmap可以实现非常复杂的扫描程序，如果基于python-nmap包，我认为可以从下面几方面进行改进：
+ 增加GUI，可以手动添加扫描的端口范围和主机；②
+ 生成csv格式的扫描报告
+ 后台进行扫描，完成后把扫描报告以邮件的形式通知管理员。
这仅仅是一个初级的端口扫描器的基本功能，准备今后可以利用这个包尝试去实现来完善。
